---
title: "Iso map"
output: html_document
date: "2023-05-01"
---

```{r setup, include=FALSE}
library(tidyverse)
library(png) #load image files
library(grid) #plot images
#install.packages("BiocManager")
#BiocManager::install("EBImage")
#install.packages("juicr")
library(juicr) #points from images
```

## Data Import
Datasheet
```{r data}
iso_orig <- readxl::read_xlsx("r_Jacquet_carb_with_cements.xlsx")
```
Images for samples
```{r images}
img3.5T <- readPNG("fuwm 3.5 top iso point image.png")
```

## Wrangle
Custom dataframes per sample
```{r filters}
iso_3.5T <- iso_orig %>%
  filter(str_detect(ID, "FUWM 3.5 T BLOCK") == TRUE)%>%
  rowid_to_column("index")
```

## ID Coords
Generates coordinates for plotting
```{r}
GUI_juicr("fuwm 3.5 top iso point image.png") #use to choose points. set axes with min = 0 and max = 1
```

Read in coordinates and add isos
```{r}
fuwm3.5Tpoints <- read.csv("fuwm 3.5 top iso point image_juicr_extracted_points.csv") %>%
  rowid_to_column("index") %>%
  inner_join(iso_3.5T, by = "index")
```

## Plots
```{r FUWM 3.5 T}
ggplot(fuwm3.5Tpoints, aes(x = x.calibrated, y = y.calibrated, color = d13C)) +
  annotation_custom(rasterGrob(img3.5T, x = unit(0.5, "npc"), y = unit(0.5, "npc")), xmin = 0, xmax = 1, ymin = 0, ymax = 1) +
  xlim(0,1) +
  ylim(0,1) +
  geom_point() +
  scale_color_distiller(palette = "RdBu") +
  coord_fixed(670/1000) +
  theme(
    panel.grid = element_line(color = "gray"),
    plot.margin = margin(0,0,0,0)
  )
```